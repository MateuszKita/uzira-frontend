<div class="backlog-view">
  <ng-container *ngIf="(selectedProjectId$ | async) !== '0' && !!tasks; else noProjects">
    <div class="sprints-header">
      <h2>Backlog</h2>
    </div>

    <mat-accordion displayMode="flat">
      <app-sprint-expansion-panel
        [expanded]="isBacklogExpanded"
        expansionPanelTitle="Backlog"
        expansionPanelSubtitle="All tasks in Backlog"
        [dataSource]="tasks"
        [sprints]="sprints"
        (taskAddition)="taskAddition($event)"
        (backlogChange)="handleBacklogChanges($event).subscribe()"
        (backlogChangeAll)="handleBacklogChanges($event, true).subscribe()">
      </app-sprint-expansion-panel>

      <mat-divider class="divider"></mat-divider>

      <div class="sprints-header">
        <h2>Sprints list</h2>
        <div class="button-wrapper">
          <button mat-raised-button
                  color="secondary"
                  class="add-sprint"
                  (click)="addSprint()">
            Add Sprint
          </button>
        </div>
      </div>

      <ng-container *ngIf="sprints.length; else noSprints">
        <ng-container *ngFor="let sprint of sprints; index as i">
          <app-sprint-expansion-panel expansionPanelTitle="Sprint {{sprint.index}}"
                                      expansionPanelSubtitle="All tasks in Sprint {{sprint.index}}[{{sprint.active ? 'Active' : 'Inactive'}}]"
                                      [expanded]="!!(isSprintExpanded && isSprintExpanded[i])"
                                      [dataSource]="sprints[i] ? sprints[i].tasks : []"
                                      [sprints]="sprints"
                                      sprintId="{{sprint._id}}"
                                      (taskAddition)="taskAddition($event, sprint._id)"
                                      (backlogChange)="handleBacklogChanges($event).subscribe()"
                                      (backlogChangeAll)="handleBacklogChanges($event, true).subscribe()"></app-sprint-expansion-panel>
        </ng-container>
      </ng-container>
    </mat-accordion>

    <ng-template #noSprints>
      <h3>Your sprints list is empty</h3>
    </ng-template>
  </ng-container>

  <ng-template #noProjects>
    <div class="loader" *ngIf="isLoading; else notLoading">
      <mat-spinner [diameter]="25"></mat-spinner>
      <h3>Loading backlog and sprints list...</h3>
    </div>
    <ng-template #notLoading>
      <h2>
        There are no projects yet, please create a project in the 'Projects' tab.
      </h2>
    </ng-template>

  </ng-template>

</div>
