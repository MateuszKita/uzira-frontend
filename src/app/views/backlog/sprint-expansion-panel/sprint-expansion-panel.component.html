<div class="expansion-panel-wrapper">
  <mat-expansion-panel [expanded]="expanded">
    <mat-expansion-panel-header>
      <mat-panel-title class="panel-title">
        {{expansionPanelTitle}}
      </mat-panel-title>
      <mat-panel-description class="panel-subtitle">
        {{expansionPanelSubtitle}}
      </mat-panel-description>
      <button mat-icon-button
              class="panel-add-task"
              (click)="addTask(); $event.stopPropagation()">
        <mat-icon>add_circle_outline</mat-icon>
      </button>
    </mat-expansion-panel-header>

    <table mat-table
           [dataSource]="dataSource"
           class="sprint-table">

      <ng-container matColumnDef="name">
        <th mat-header-cell
            *matHeaderCellDef
            class="name">Name
        </th>
        <td mat-cell
            *matCellDef="let element"
            class="name">
          {{element.name}}</td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell
            *matHeaderCellDef
            class="type">Type
        </th>
        <td mat-cell
            *matCellDef="let element"
            class="type">
          {{element.type}}</td>
      </ng-container>

      <ng-container matColumnDef="estimation">
        <th mat-header-cell
            *matHeaderCellDef
            class="estimation">Estimation
        </th>
        <td mat-cell
            *matCellDef="let element"
            class="estimation">
          {{element.estimation}}</td>
      </ng-container>

      <ng-container matColumnDef="assigned">
        <th mat-header-cell
            *matHeaderCellDef
            class="assigned">Assigned
        </th>
        <td mat-cell
            *matCellDef="let element"
            class="assigned">
          {{element.assigned?.name}}</td>
      </ng-container>

      <ng-container matColumnDef="edit">
        <th mat-header-cell
            *matHeaderCellDef
            class="edit"></th>
        <td mat-cell
            *matCellDef="let element"
            class="edit">
          <button mat-icon-button
                  matTooltip="Edit Task"
                  (click)="editTask(element)">
            <mat-icon>
              edit
            </mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="move">
        <th mat-header-cell
            *matHeaderCellDef
            class="move"></th>
        <td mat-cell
            *matCellDef="let element"
            class="move">
          <button *ngIf="sprintId; else buttonWithMenuOpen"
                  mat-icon-button
                  [matTooltip]="'Move task to Backlog'"
                  (click)="moveTask(element._id)">
            <mat-icon>
              arrow_right_alt
            </mat-icon>
          </button>
          <ng-template #buttonWithMenuOpen>
            <button mat-icon-button
                    [matTooltip]="'Move task to Sprint'"
                    [matMenuTriggerFor]="sprintsList">
              <mat-icon>
                arrow_right_alt
              </mat-icon>
            </button>
          </ng-template>
          <div [hidden]="sprintId">
            <mat-menu #sprintsList="matMenu">
              <button mat-menu-item *ngFor="let sprint of sprints"
                      (click)="moveTask(element._id, sprint._id)">
                Sprint {{sprint.index}}
              </button>
            </mat-menu>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="delete">
        <th mat-header-cell
            *matHeaderCellDef
            class="delete"></th>
        <td mat-cell
            *matCellDef="let element"
            class="edit">
          <button mat-icon-button
                  matTooltip="Delete Task"
                  (click)="deleteTask(element._id)">
            <mat-icon>
              delete
            </mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row
          *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row
          *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <ng-container *ngIf="!dataSource?.length">
      <h3>List of tasks is empty</h3>
    </ng-container>

  </mat-expansion-panel>
</div>
